<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>WebShare Testing</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body>
    <h1>
        Test WebShare
      </h1>
      
      <input type="checkbox" name="fetch" id="fetch">Fetch?

        <button id="test-web-share">
          Click Me
        </button>
      
      
      
        <button id="test-web-share-250">
          Click Me - 250 ms delay
        </button>
      
      
      
        <button id="test-web-share-550">
          Click Me - 500 ms delay
        </button>
      
      
      
        <button id="test-web-share-999">
          Click Me - 999 ms delay
        </button>
      
      
      
      
        <button id="test-web-share-1005">
          Click Me - 1005 ms delay
        </button>
      
      
      <script>
        document.querySelector('#fetch').addEventListener('change', function {
          window.fetch = this.checked;
        });
        
      function directShare() {
        navigator.share({
          title: 'My awesome post!',
          text: 'This post may or may not contain the answer to the universe',
          url: window.location.href
        }).then(() => {
          window.alert('Thanks for sharing!');
        })
        .catch(err => {
          window.alert(`Couldn't share because of`, err);
        });
      }
      function webShare() {
        if (navigator.share) {
          if (window.fetch) {
            let myRequest = new Request('https://mkonikov.com/images/instants.jpg');

            fetch(myRequest)
            .then(function(response) {
              if (!response.ok) {
                throw new Error('HTTP error, status = ' + response.status);
              }
              return response.blob();
            })
            .then(function(response) {
              directShare();
            })
          }
          else {
            directShare();
          }
        } else {
          window.alert('web share not supported');
        }
      }

      function delayedWebShare(delay) {
        window.setTimeout(webShare, delay);
      }
      
      document.querySelector('#test-web-share').addEventListener('click', () => {
        webShare()
      });
      
      document.querySelector('#test-web-share-250').addEventListener('click', () => {
        delayedWebShare(250)
      });
      
      document.querySelector('#test-web-share-550').addEventListener('click', () => {
        delayedWebShare(550)
      });
      
      document.querySelector('#test-web-share-999').addEventListener('click', () => {
        delayedWebShare(999)
      });
      
      document.querySelector('#test-web-share-1005').addEventListener('click', () => {
        delayedWebShare(1005)
      });
      </script>
</body>
</html>